set(PROTO_BINARY_DIR "${CMAKE_CURRENT_BINARY_DIR}/_generated")
file(MAKE_DIRECTORY ${PROTO_BINARY_DIR})

if(WIN32)
    protobuf_generate(
        PROTOC_OUT_DIR ${PROTO_BINARY_DIR}
        OUT_VAR PROTO_GENERATED_FILES
        EXPORT_MACRO DYDX_V4_PROTO_EXPORT
        LANGUAGE cpp
        PROTOS ${proto_files})
else()
    protobuf_generate(
        PROTOC_OUT_DIR ${PROTO_BINARY_DIR}
        OUT_VAR PROTO_GENERATED_FILES
        LANGUAGE cpp
        PROTOS ${proto_files})
endif()

add_custom_target(generate_proto_files DEPENDS ${PROTO_GENERATED_FILES})
list(GET PROTO_GENERATED_FILES 0 2 FIRST_THREE)
string(JOIN ", " FIRST_THREE_STR ${FIRST_THREE})
message(STATUS "Generated protobuf files: ${FIRST_THREE_STR}")
